openapi: 3.0.3
info:
  title: RAG Agent API
  description: API for the RAG-enabled AI agent that answers questions using retrieved book content
  version: 1.0.0
servers:
  - url: http://localhost:8000
    description: Development server
  - url: https://api.rag-agent.example.com
    description: Production server

paths:
  /query:
    post:
      summary: Query the RAG agent with a question about book content
      description: Submit a natural language query to retrieve answers from book content with citations
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QueryRequest'
      responses:
        '200':
          description: Successful response with answer and citations
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QueryResponse'
        '400':
          description: Bad request - invalid query format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /health:
    get:
      summary: Health check endpoint
      description: Check if the RAG agent service is running and healthy
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "healthy"
                  timestamp:
                    type: string
                    format: date-time
                    example: "2025-12-25T10:00:00Z"

components:
  schemas:
    QueryRequest:
      type: object
      required:
        - query
      properties:
        query:
          type: string
          description: The user's question about book content
          example: "What are the key principles of embodied cognition discussed in the book?"
        include_citations:
          type: boolean
          description: Whether to include citation information in the response
          default: true
        max_results:
          type: number
          description: Maximum number of documents to retrieve for context
          default: 5
          minimum: 1
          maximum: 20

    QueryResponse:
      type: object
      required:
        - query
        - answer
        - citations
        - retrieved_documents_count
      properties:
        query:
          type: string
          description: The original user query
          example: "What are the key principles of embodied cognition discussed in the book?"
        answer:
          type: string
          description: The AI-generated answer based on retrieved content
          example: "The key principles of embodied cognition include the idea that cognitive processes are deeply rooted in the body's interactions with the environment..."
        citations:
          type: array
          description: List of sources used to generate the answer
          items:
            $ref: '#/components/schemas/Citation'
        retrieved_documents_count:
          type: number
          description: Number of documents retrieved and used for the response
          example: 3
        processing_time:
          type: number
          description: Time taken to process the query in milliseconds
          example: 1250

    Citation:
      type: object
      required:
        - document_id
        - source
        - text_snippet
      properties:
        document_id:
          type: string
          description: Unique identifier for the source document
          example: "doc_12345"
        source:
          type: string
          description: Human-readable source reference
          example: "Chapter 3: Embodied Cognition Principles, Book Title"
        text_snippet:
          type: string
          description: Relevant text excerpt from the source document
          example: "Embodied cognition suggests that cognitive processes are not confined to the brain but emerge from the interaction between the body and the environment..."

    ErrorResponse:
      type: object
      required:
        - error
        - message
      properties:
        error:
          type: string
          description: Error code
          example: "QUERY_FAILED"
        message:
          type: string
          description: Human-readable error message
          example: "Failed to process query: no relevant documents found"
        details:
          type: object
          description: Additional error details (optional)